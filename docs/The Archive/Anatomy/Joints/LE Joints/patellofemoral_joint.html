<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>YK Lab - Patellofemoral Joint</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../">
<link href="../../../..//images/icons8-brain-64.png" rel="icon" type="image/png">
<script src="../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../../../index.html">
    <span class="navbar-title">YK Lab</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../The Archive/archive_index.html" rel="" target="">
 <span class="menu-text">Archive</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../guide.html" rel="" target="">
 <span class="menu-text">Guide</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../journal club index.html" rel="" target="">
 <span class="menu-text">Journal Club</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#kinetics" id="toc-kinetics" class="nav-link active" data-scroll-target="#kinetics">Kinetics</a>
  <ul class="collapse">
  <li><a href="#joint-compression" id="toc-joint-compression" class="nav-link" data-scroll-target="#joint-compression">Joint compression</a></li>
  <li><a href="#factors-affecting-patella-tracking" id="toc-factors-affecting-patella-tracking" class="nav-link" data-scroll-target="#factors-affecting-patella-tracking">Factors affecting Patella Tracking</a>
  <ul class="collapse">
  <li><a href="#quadricep-role" id="toc-quadricep-role" class="nav-link" data-scroll-target="#quadricep-role">Quadricep Role</a></li>
  </ul></li>
  <li><a href="#factors-that-naturally-oppose-the-lateral-pull-of-the-quadriceps-on-the-patella" id="toc-factors-that-naturally-oppose-the-lateral-pull-of-the-quadriceps-on-the-patella" class="nav-link" data-scroll-target="#factors-that-naturally-oppose-the-lateral-pull-of-the-quadriceps-on-the-patella">Factors That Naturally Oppose the Lateral Pull of the Quadriceps on the Patella</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Patellofemoral Joint</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-contents">
             <p>Nathaniel Yomogida, SPT </p>
             <p>Chloë Kerstein, SPT </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<p>The PFJ is a complex articulation, dependent on both dynamic and static restraints for its function and stability. The patella (Fig. 20-1), a ubiquitous sesamoid bone found in birds and mammals, plays an important role in the biomechanics of the knee. Its articular anatomy is uncomplicated: it is a very hard, triangular-shaped bone, situated in the intercondylar notch and embedded in the tendon of the quadriceps femoris muscle above and the patellar tendon below. The groove has a complex architecture with increasing height of the groove’s lateral facet at the proximal aspect, providing a deeper “patella track” in knee extension.5 In healthy individuals, aspects of the femoral trochlea including its depth, as well as the shape and height of the lateral trochlea, can affect patellar tracking.6,7 From 20 to 30 degrees of knee flexion, the patella is confined within the trochlea and hence, the bony joint components provide inherent stability but, once beyond this range, there is little intrinsic bony support and stability must be provided by other soft-tissue structures, both passively and actively.6 The thickness of the patella varies considerably, attaining a maximum height of 2–2.5 cm (0.77–1 in) at its central portion.1 The posterior surface of the patella can include up to seven facets. The geometry of these facets varies between individuals and may affect patellar tracking.6 A smaller facet, known as the odd facet, exists medially and is delineated by a second vertical ridge. These concave medial and lateral facets are separated by a vertical ridge and are covered with aneural hyaline cartilage, the thickest cartilage in the body (up to 7 mm thick).1 The articular cartilage of the patella is unique because it lacks conformity with the underlying bone.8 The hyaline cartilage, here as elsewhere, functions to minimize the friction that occurs at the functional contact areas of the joint surfaces.</p>
<p>Radiographic and cadaver studies have classified the patella into three Wiberg classifications (type A–C) based on the size and shape of these lateral and medial facets.</p>
<p>The patellar surface of the femur is divided into medial and lateral facets that closely correspond to those on the posterior surface of the patella. The PFJ functions to</p>
<p>provide the articulation with low friction; ▶ protect the distal aspect of the femur from trauma and the quadriceps from attritional wear; ▶ improve the cosmetic appearance of the knee; ▶ improve the moment arm (distance from the center of gravity and the center of rotation) of the quadriceps. This is achieved by elevating the quadriceps femoris muscle from the center of knee rotation. This increases the efficiency of the quadriceps muscle and provides it with leverage for extending the leg. The patellar contribution to the knee extensor moment arm increases with increasing amounts of knee extension; and ▶ decrease the amount of anteroposterior tibiofemoral shear stress placed on the joint.</p>
<section id="kinetics" class="level1">
<h1>Kinetics</h1>
<p>“The patellofemoral joint is routinely exposed to high magnitudes of compression force. A sampling of these forces includes 1.3 times body weight during walking on level surfaces, 2.6 times body weight during performance of a straight leg raise, 3.3 times body weight during climbing of stairs, and up to 7.8 times body weight during performance of deep “knee bends” or squats.81,183,270,291 Although these compression forces originate primarily from active forces produced from the overlying quadriceps their magnitude is strongly influenced by the amount of knee flexion at the time of muscle activation.53 To illustrate this important interaction, consider the compression force on the patellofemoral joint in a partial squat position (Fig. 13.28A). Forces within the extensor mechanism are transmitted proximally and distally through the quadriceps tendon (QT) and patellar tendon (PT), much like a cable crossing a pulley. The resultant, or combined, effect of these forces is directed toward the trochlear groove of the femur as a joint compression force (CF). Increasing knee flexion by descending into a deeper squat significantly raises the force demands throughout the extensor mechanism, and ultimately on the patellofemoral joint (see Fig. 13.28B). The increased knee flexion associated with the deeper squat also reduces the angle formed by the intersection of force vectors QT and PT. As shown by vector addition, reducing the angle of these force increases the magnitude of the CF directed between the patella and the femur. In theory, if the QT and PT vectors were collinear and oriented in opposite directions, the muscular-based compression force on the patellofemoral joint would be zero.”<span class="citation" data-cites="neumannKinesiologyMusculoskeletalSystem2017"><sup><a href="#ref-neumannKinesiologyMusculoskeletalSystem2017" role="doc-biblioref">1</a></sup></span></p>
<section id="joint-compression" class="level2">
<h2 class="anchored" data-anchor-id="joint-compression">Joint compression</h2>
<p>“Both the compression force and the area of articular contact on the patellofemoral joint increase with knee flexion, reaching a maximum between 60 and 90 degrees.139,199,279 As described earlier, the compression force can rise to very high levels during a descent into a squat or lunge position. Because increased knee flexion is associated with a greater relative increase in compression force than relative increase in articular contact area, the stress (force/area) is also greatest in the patellofemoral joint in the position of 60 to 90 degrees of knee flexion.53,261 Without the relatively large contact area to disperse the large compression force produced by the quadriceps, the stress within the joint would likely rise to intolerable physiologic levels.40,111 Having the area of joint contact greatest at positions that are generally associated with the largest muscular-based compression force naturally protects the joint against stress-induced cartilage degeneration. This mechanism allows most healthy and normally aligned patellofemoral joints to tolerate large compression forces over a lifetime, often with little or no appreciable discomfort or degeneration of the articular cartilage or subchondral bone. As will be explained, for many persons, however, the natural high-force environment within the patellofemoral joint is a major contributing factor to the development of patellofemoral pain syndrome.”<span class="citation" data-cites="neumannKinesiologyMusculoskeletalSystem2017"><sup><a href="#ref-neumannKinesiologyMusculoskeletalSystem2017" role="doc-biblioref">1</a></sup></span></p>
</section>
<section id="factors-affecting-patella-tracking" class="level2">
<h2 class="anchored" data-anchor-id="factors-affecting-patella-tracking">Factors affecting Patella Tracking</h2>
<p>“The large compression forces that naturally occur at the patellofemoral joint are typically well tolerated, provided that the forces are evenly dispersed across the largest possible area of articular surface. A joint with less than optimal congruity, or one with subtle structural anomalies, will likely experience abnormal “tracking” of the patella. As a consequence, the patellofemoral joint is exposed to higher joint contact stress, thereby increasing its risk for developing degenerative lesions and pain. Such a scenario may lead to patellofemoral pain syndrome or potentially trigger osteoarthritis later in life. ”<span class="citation" data-cites="neumannKinesiologyMusculoskeletalSystem2017"><sup><a href="#ref-neumannKinesiologyMusculoskeletalSystem2017" role="doc-biblioref">1</a></sup></span></p>
<section id="quadricep-role" class="level3">
<h3 class="anchored" data-anchor-id="quadricep-role">Quadricep Role</h3>
<p>“Among the most important influences on patellofemoral joint biomechanics are the magnitude and direction of force produced by the overlying quadriceps muscle. As the knee is extending, the contracting quadriceps pulls the patella not only superiorly within the trochlear groove of the femur, but also slightly laterally and posteriorly. The slight but omnipresent lateral line of force exerted by the quadriceps results, in part, from the larger crosssectional area and force potential of the vastus lateralis. Because of the purported association between patellofemoral joint pain and excessive lateral tracking (and possible dislocation) of the patella, assessing the overall lateral line of pull of the quadriceps relative to the patella is a meaningful clinical measure. Such a measure is referred to as the quadriceps angle, or more commonly the Q-angle (Fig. 13.29A).91,244 The Q-angle is determined first by constructing a line representing an estimation of the resultant force vector of the different heads of the quadriceps. This line connects a point between the anterior-superior iliac spine and the midpoint of the patella.310 A second line is drawn representing the long axis of the patellar tendon, made by connecting a point on the tibial tuberosity with the midpoint of the patella. The Q-angle is formed at the intersection of these two lines, typically measuring about 13 to 15 degrees (±4.5 degrees) within a healthy adult population.244 The Q-angle assessment has been criticized for its poor association with pathology at the patellofemoral joint, inadequate standardized measurement protocol, and inability to measure dynamic alignment.124,177,260 Nevertheless, the Q-angle remains a popular and simple clinical index for a general assessment of the relative lateral pull of the quadriceps on the patella. Factors that naturally offset or limit the lateral pull of the patella are described in the next section. If these factors fail to operate in a coordinated fashion, the patella may track (shift and tilt) more laterally within the trochlear groove—kinematics that reduce contact area, increase patellofemoral joint stress and pain, and potentially increase the likelihood of chronic lateral dislocation of the patella.”<span class="citation" data-cites="neumannKinesiologyMusculoskeletalSystem2017"><sup><a href="#ref-neumannKinesiologyMusculoskeletalSystem2017" role="doc-biblioref">1</a></sup></span></p>
<p>“Activation of the quadriceps as a whole also pulls and compresses the patella posteriorly against the femur, thereby stabilizing its path of movement relative to the distal femur. This stabilization effect increases with the knee in greater flexion (review Fig. 13.28). Even in full knee extension, however, some fibers of the quadriceps are aligned to produce a posterior compression through the patellofemoral joint.287 This is particularly apparent by observing a side-view diagram of the line of force of the oblique fibers of the vastus medialis (see Fig. 13.29B). Although relatively small, this posterior stabilizing effect on the patella is especially useful in the last 20 to 30 degrees of extension, at a point when (1) the patella is no longer fully engaged within the trochlear groove of the femur and (2) the resultant patellofemoral joint compression (stabilizing) force produced by the activated quadriceps as a whole is least.4”</p>
</section>
</section>
<section id="factors-that-naturally-oppose-the-lateral-pull-of-the-quadriceps-on-the-patella" class="level2">
<h2 class="anchored" data-anchor-id="factors-that-naturally-oppose-the-lateral-pull-of-the-quadriceps-on-the-patella">Factors That Naturally Oppose the Lateral Pull of the Quadriceps on the Patella</h2>
<p>“Several factors throughout the lower extremity oppose and thereby limit the lateral bias in pull of the quadriceps relative to the patellofemoral joint. These factors are important to optimal tracking. In this context, optimal tracking is defined as movement between the patella and femur across the greatest possible area of articular surface with the least possible stress. Understanding the factors that favor optimal tracking provides insight into most pathomechanics and many treatments for pain and other dysfunctions of the patellofemoral joint. Both local and global factors will be described. Local factors are those that act directly on the patellofemoral joint. Global factors, on the other hand, are those related to the alignment of the bones and joints of the lower limb. Although these factors are described as separate entities, in reality, their effectiveness in optimizing patellar tracking is based on the sum of their combined influences.”<span class="citation" data-cites="neumannKinesiologyMusculoskeletalSystem2017"><sup><a href="#ref-neumannKinesiologyMusculoskeletalSystem2017" role="doc-biblioref">1</a></sup></span></p>



</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body" role="list">
<div id="ref-neumannKinesiologyMusculoskeletalSystem2017" class="csl-entry" role="listitem">
<div class="csl-left-margin">1. </div><div class="csl-right-inline">Neumann DA, Kelly ER, Kiefer CL, Martens K, Grosz CM. <em>Kinesiology of the Musculoskeletal System: Foundations for Rehabilitation</em>. 3rd ed. Elsevier; 2017.</div>
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>